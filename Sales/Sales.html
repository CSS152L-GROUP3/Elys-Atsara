<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta charset="utf-8" />
  <title> Ely's Atsara</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>

<body>
  <div class="homepage">
    <div class="div">

      <div class="top-Nav">
        <div class="About">
          <div class="group1">
            <button class="AboutUsBtn1">
              <svg width="60" height="58" viewBox="0 0 60 58" fill="none" xmlns="http://www.w3.org/2000/svg">
                <rect width="60" height="58" rx="29" fill="#B3261E" />
                <path
                  d="M30 32.7926C32.8821 32.7926 35.4908 31.3762 37.3795 29.0873C39.2661 26.8008 40.4348 23.6392 40.4348 20.1463C40.4348 16.6534 39.2661 13.4918 37.3795 11.2054C35.4908 8.91639 32.8821 7.5 30 7.5C27.1179 7.5 24.5092 8.91639 22.6205 11.2054C20.7339 13.4918 19.5652 16.6534 19.5652 20.1463C19.5652 23.6392 20.7339 26.8008 22.6205 29.0873C23.5885 30.2636 24.7387 31.1966 26.0051 31.8325C27.2716 32.4684 28.6292 32.7947 30 32.7926ZM46.6957 35.3219C47.3812 35.3236 48.0603 35.1611 48.6939 34.844C49.3275 34.5268 49.9032 34.0611 50.388 33.4736C50.8727 32.8861 51.257 32.1884 51.5187 31.4205C51.7804 30.6526 51.9144 29.8296 51.913 28.9987C51.913 27.2535 51.3308 25.6728 50.3854 24.527C49.9014 23.939 49.3262 23.4727 48.693 23.155C48.0598 22.8372 47.381 22.6743 46.6957 22.6756C46.0101 22.6739 45.331 22.8363 44.6974 23.1535C44.0638 23.4707 43.4881 23.9364 43.0033 24.5239C42.5186 25.1114 42.1343 25.8091 41.8726 26.577C41.6109 27.3449 41.4769 28.1679 41.4783 28.9987C41.4772 29.8295 41.6114 30.6523 41.8732 31.4201C42.135 32.1878 42.5192 32.8854 43.0039 33.4729C43.4886 34.0603 44.0642 34.526 44.6977 34.8433C45.3312 35.1606 46.0102 35.3232 46.6957 35.3219ZM46.6957 36.8142C43.9179 36.8142 41.8289 37.841 40.608 39.2625C38.281 36.9432 34.6017 35.3219 30 35.3219C25.271 35.3219 21.6626 36.9609 19.3732 39.2777C18.1294 37.8486 16.0174 36.8142 13.3043 36.8142C8.73809 36.8142 6 39.5711 6 42.333C6 43.7115 8.73809 45.095 13.3043 45.095C14.5649 45.095 15.696 44.966 16.6915 44.7586L16.608 45.4415C16.608 47.9707 21.6292 50.5 30 50.5C37.8511 50.5 43.392 47.9707 43.392 45.4415L43.3503 44.7965C44.3165 44.9811 45.4268 45.095 46.6957 45.095C50.976 45.095 54 43.7115 54 42.333C54 39.5711 51.1346 36.8142 46.6957 36.8142ZM13.3043 35.3219C14.7443 35.3219 16.0487 34.6162 16.9941 33.4705C17.4793 32.8839 17.864 32.1868 18.1262 31.4194C18.3884 30.652 18.5228 29.8293 18.5217 28.9987C18.5231 28.1679 18.3891 27.3449 18.1274 26.577C17.8657 25.8091 17.4814 25.1114 16.9967 24.5239C16.5119 23.9364 15.9362 23.4707 15.3026 23.1535C14.669 22.8363 13.9899 22.6739 13.3043 22.6756C12.6189 22.6742 11.9399 22.8369 11.3064 23.1542C10.6729 23.4715 10.0973 23.9372 9.61264 24.5246C9.12794 25.112 8.74368 25.8096 8.48187 26.5774C8.22006 27.3452 8.08586 28.168 8.08696 28.9987C8.08558 29.8296 8.21959 30.6526 8.48131 31.4205C8.74302 32.1884 9.12727 32.8861 9.61203 33.4736C10.0968 34.0611 10.6725 34.5268 11.3061 34.844C11.9397 35.1611 12.6188 35.3236 13.3043 35.3219Z"
                  fill="white" />
              </svg>
            </button>
            <button class="AboutUsBtn2" onclick="window.location.href='../AboutUs/AboutUs.html'">About Us</button>
          </div>
        </div>

        <div class="Cart">
          <a href="../AdminDashboard/Dashboard.html" style="text-decoration: none; color: inherit;">
            <div class="group2" style="display: flex; flex-direction: row; align-items: center; gap: 12px;">
              <span class="nav-label">Dashboard</span>
              <button class="DashBtn1" style="border: none; background: none; outline: none; box-shadow: none;">
                <svg width="60" height="58" viewBox="0 0 60 58" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect width="60" height="58" rx="29" fill="#B3261E"/>
                  <path d="M17.5556 30.6667H26.8889C27.7444 30.6667 28.4444 29.9167 28.4444 29V15.6667C28.4444 14.75 27.7444 14 26.8889 14H17.5556C16.7 14 16 14.75 16 15.6667V29C16 29.9167 16.7 30.6667 17.5556 30.6667ZM17.5556 44H26.8889C27.7444 44 28.4444 43.25 28.4444 42.3333V35.6667C28.4444 34.75 27.7444 34 26.8889 34H17.5556C16.7 34 16 34.75 16 35.6667V42.3333C16 43.25 16.7 44 17.5556 44ZM33.1111 44H42.4444C43.3 44 44 43.25 44 42.3333V29C44 28.0833 43.3 27.3333 42.4444 27.3333H33.1111C32.2556 27.3333 31.5556 28.0833 31.5556 29V42.3333C31.5556 43.25 32.2556 44 33.1111 44ZM31.5556 15.6667V22.3333C31.5556 23.25 32.2556 24 33.1111 24H42.4444C43.3 24 44 23.25 44 22.3333V15.6667C44 14.75 43.3 14 42.4444 14H33.1111C32.2556 14 31.5556 14.75 31.5556 15.6667Z" fill="white"/>
                </svg>
              </button>
            </div>
          </a>
        </div>

        <div class="Account">
          <div class="group4">
            <button class="AccountBtn1">
              <svg width="60" height="58" viewBox="0 0 60 58" fill="none" xmlns="http://www.w3.org/2000/svg"
                z-index="0">
                <rect width="60" height="58" rx="29" fill="#B3261E" />
                <path
                  d="M39 16.4999C39 12.4849 34.818 9 30 9C25.182 9 21 12.4849 21 16.4999C21 20.5148 25.182 23.9998 30 23.9998C34.818 23.9998 39 20.5148 39 16.4999ZM30 26.4997C22.116 26.4997 15 33.5871 15 42.3945C15 51.2018 45 51.2018 45 42.3945C45 33.5871 37.884 26.4997 30 26.4997Z"
                  fill="white" />
              </svg>
            </button>
            <button class="AccountBtn2" onclick="window.location.href='#####'">Account</button>
          </div>
        </div>

        <div class="Maps">
          <div class="group3">
            <a href="../MapsPage/Mapspage.html">
              <button class="MapBtn1">
                <svg width="60" height="58" viewBox="0 0 60 58" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <ellipse cx="30" cy="29" rx="30" ry="29" fill="#B3261E" />
                  <path
                    d="M46.776 17.5289L35.976 14.0866H35.85C35.7662 14.0785 35.6818 14.0785 35.598 14.0866H35.184H34.95H34.824L24.6 17.4428L14.376 14.0866C14.1053 14.0012 13.8173 13.9786 13.5356 14.0205C13.254 14.0623 12.9868 14.1676 12.756 14.3275C12.5234 14.4859 12.3335 14.6949 12.202 14.9374C12.0706 15.1798 12.0013 15.4486 12 15.7217V39.8179C11.999 40.1788 12.1167 40.5307 12.3363 40.8242C12.556 41.1176 12.8665 41.3376 13.224 41.453L24.024 44.8953C24.3866 45.0084 24.7774 45.0084 25.14 44.8953L35.4 41.6251L45.624 44.9814C45.8151 45.0062 46.0089 45.0062 46.2 44.9814C46.5764 44.9865 46.9437 44.8714 47.244 44.6544C47.4766 44.496 47.6665 44.287 47.798 44.0446C47.9294 43.8021 47.9987 43.5333 48 43.2602V19.164C48.001 18.8032 47.8833 18.4512 47.6637 18.1578C47.444 17.8643 47.1335 17.6444 46.776 17.5289ZM22.8 40.8678L15.6 38.5787V18.1141L22.8 20.4032V40.8678ZM33.6 38.5787L26.4 40.8678V20.4032L33.6 18.1141V38.5787ZM44.4 40.8678L37.2 38.5787V18.1141L44.4 20.4032V40.8678Z"
                    fill="white" />
                </svg>
              </button>
            </a>
            <button class="MapBtn2" onclick="window.location.href='../MapsPage/Mapspage.html'">Maps</button>
          </div>
        </div>
      </div>

      <!-- Custom Modal for Cart Access -->
      <div id="cartModal" class="modal">
        <div class="modal-content enhanced-modal">
          <span class="close-btn" id="closeCartModal">&times;</span>
          <div class="modal-icon">
            <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="24" cy="24" r="24" fill="#B3261E" />
              <path d="M24 14V26" stroke="#fff8f3" stroke-width="3" stroke-linecap="round" />
              <circle cx="24" cy="33" r="2" fill="#fff8f3" />
            </svg>
          </div>
          <h2 style="margin-top: 0.5em;">Guest Account</h2>
          <p style="margin-bottom: 1.5em;">You are using a guest account. Please log in to access the cart.</p>
          <button id="loginRedirectBtn">Log In</button>
        </div>
      </div>

      <!-- Custom Modal for Account Access -->
      <div id="accountModal" class="modal">
        <div class="modal-content enhanced-modal">
          <span class="close-btn" id="closeAccountModal">&times;</span>
          <div class="modal-icon">
            <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="24" cy="24" r="24" fill="#B3261E" />
              <path d="M24 14V26" stroke="#fff8f3" stroke-width="3" stroke-linecap="round" />
              <circle cx="24" cy="33" r="2" fill="#fff8f3" />
            </svg>
          </div>
          <h2 style="margin-top: 0.5em;">Account Access</h2>
          <p style="margin-bottom: 1.5em;">You must be logged in to view your account.</p>
          <button id="accountLoginRedirectBtn" class="modal-login-btn">
            <svg style="vertical-align: middle; margin-right: 8px; margin-bottom: 2px;" width="22" height="22"
              viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect width="24" height="24" rx="12" fill="#fff8f3" />
              <path d="M12 8V16M8 12H16" stroke="#B3261E" stroke-width="2.2" stroke-linecap="round" />
            </svg>
            <span style="vertical-align: middle; font-weight: 700; font-size: 1.1rem;">Log In</span>
          </button>
        </div>
      </div>

      <script>
        // Modal logic for Cart guest warning
        function userIsLoggedIn() {
          const userType = sessionStorage.getItem('userType');
          const userJson = localStorage.getItem('currentUser');
          return userType && userType !== 'guest' && userJson;
        }

        // Attach modal logic to both cart buttons
        $('.CartBtn1, .CartBtn2').on('click', function (e) {
          const userType = sessionStorage.getItem('userType');
          if (!userIsLoggedIn()) {
            e.preventDefault();
            $('#cartModal').css('display', 'flex');
          } else if (userType === 'admin') {
            window.location.href = '../adminCart/admin-cart.html';
          } else {
            window.location.href = '../updatedCartPage/Cartpage.html';
          }
        });

        $('#closeCartModal').on('click', function () {
          $('#cartModal').css('display', 'none');
        });
        $('#loginRedirectBtn').on('click', function () {
          window.location.href = '../accountLogin/account-login.html';
        });
        $(window).on('click', function (event) {
          if (event.target === document.getElementById('cartModal')) {
            $('#cartModal').css('display', 'none');
          }
        });

        // Modal logic for Account access
        $('.AccountBtn1, .AccountBtn2').on('click', function (e) {
          const userJson = localStorage.getItem('currentUser');
          if (!userJson) {
            e.preventDefault();
            $('#accountModal').css('display', 'flex');
          } else {
            window.location.href = '../profile/UserProfile.html';
          }
        });

        $('#closeAccountModal').on('click', function () {
          $('#accountModal').css('display', 'none');
        });

        $('#accountLoginRedirectBtn').on('click', function () {
          window.location.href = '../accountLogin/account-login.html';
        });

        $(window).on('click', function (event) {
          if (event.target === document.getElementById('accountModal')) {
            $('#accountModal').css('display', 'none');
          }
        });
      </script>

      <div class="sales-container">
        <div class="export-buttons">
          <button id="exportCSV">Export CSV</button>
          <button id="exportPDF">Export PDF</button>
        </div>
        <h1 class="sales-title">Sales Report</h1>
        <div class="sales-grid">

          <!-- Total Sales with Sparkline -->
          <div class="sales-card">
            <h2 class="card-title">Total Sales</h2>
            <div class="average-value-display" id="totalSalesValue">₱0.00</div>
            <canvas id="salesTrendChart" height="50"></canvas>
          </div>

          <!-- Total Orders with Mini Bar -->
          <div class="sales-card">
            <h2 class="card-title">Total Orders</h2>
            <div class="average-value-display" id="totalOrdersValue">0</div>
            <canvas id="ordersBarChart" height="50"></canvas>
          </div>

          <!-- Average Order Value -->
          <div class="sales-card">
            <h2 class="card-title">Average Order Value</h2>
            <div class="aov-container">
              <div class="average-value-display" id="averageOrderValue">₱0.00</div>
              <div class="aov-trend" id="aovTrend"></div>
            </div>
          </div>

          <!-- Payment Method Preference (Doughnut + Hover) -->
          <div class="sales-card">
            <h2 class="card-title">Payment Method Breakdown</h2>
            <div class="chart-container">
              <canvas id="paymentChart"></canvas>
            </div>
            <div class="legend" id="paymentLegend"></div>
          </div>

          <!-- Orders by City (Stacked Bar) -->
          <div class="sales-card">
            <h2 class="card-title">Orders by City & Method</h2>
            <div class="chart-container">
              <canvas id="cityStackedBarChart"></canvas>
            </div>
          </div>

          <!-- Top Products Sold (Horizontal Bar Chart) -->
          <div class="sales-card">
            <h2 class="card-title">Top Products Sold</h2>
            <div class="chart-container" style="height: 350px;">
              <canvas id="topProductsChart"></canvas>
            </div>
          </div>
        </div>
      </div>



</body>
<script type="module" src="../supabaseClient/homepage.js"></script>
<script type="module" src="../Sales/Sales.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

</html>